<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="common.css">
	<script src="common.js"></script>
</head>
<body>
	<div id="status"></div>
	<div class="choices">
		<div style="color: #888;">No CVs were generated yet, go to 'Generator' tab and generate some</div>
	</div>
</body>

<script>
	document.addEventListener("DOMContentLoaded", async () => {
		let resp = await fetch2("getGeneratedCVs")
		let cvs = resp.json
		console.log(cvs)
		if (cvs.length > 0) {
			document.querySelector(".choices").innerHTML = ""
			for (let cv of cvs) {
				createElement(cv.id, cv.name, cv.selected, cv.generated, cv.html)
			}
		}
	})

	const createElement = (id, name, selected, generated, rawHtml) => {
		let d = document.createElement("div")
		let overlay = document.createElement("div")
		let button = document.createElement("button")
		let iframe = document.createElement("iframe")

		if (selected) d.classList.add("selected")
		overlay.classList.add("overlay")
		button.innerText = "Select"
		button.addEventListener("click", async () => {
			let resp = await fetch2("setCurrentCV", {id})
			if (resp.ok) notif("Selected CV #"+id)
			else notif("Failed to set current CV: "+resp.json)
			let x = document.querySelector(".choices").children
			for (let y of x) {
				console.log(y)
				y.classList.remove("selected")
			}
			d.classList.add("selected")
		})
		iframe.classList.add("cv", "small")
		iframe.scrolling = "no"
		iframe.srcdoc = rawHtml

		overlay.appendChild(button)
		d.appendChild(overlay)
		d.appendChild(iframe)
		document.querySelector(".choices").appendChild(d)
	}

</script>

<style>
	.choices {
		display: flex;
		align-items: center;
		justify-content: center;
		flex-wrap: wrap;
	}
	.choices > div {
		margin: 8px;
		position: relative;
	}
	.choices > div.selected::after {
		content: "Selected";
		position: absolute;
		bottom: 4px;
		left: 0;
		border-radius: 0 0 12px 12px;
		width: calc(100% - 8px);
		background: #222D;
		z-index: 1;
		padding: 16px 0;
		margin: 4px;
		text-align: center;
	}
	.choices .overlay {
		position: absolute;
		width: 100%;
		height: 100%;
		opacity: 0;
		background: #222D;
		display: flex;
		align-items: center;
		justify-content: center;
		transition: all .3s;
	}
	.choices > div:hover .overlay {
		opacity: 1;
	}
	.choices .overlay button {
		background: #66B;
		color: #FFF;
		box-shadow: 0 0 48px #222;
	}
	.choices > div .overlay button:hover {
		background: #99F;
		color: #000;
	}
	iframe {
		pointer-events: none;
	}
</style>
</html>
